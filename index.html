<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>西武線リアルタイム列車位置（種別色分け版）</title>
<style>
body { font-family: sans-serif; margin: 20px; }
#controls { margin-bottom: 10px; }
#diagram { border:1px solid #444; display:block; margin-bottom:10px; }
#log { font-size: 12px; background:#f5f5f5; padding:6px; border:1px solid #ccc; white-space:pre-wrap; max-height:180px; overflow:auto; }
</style>
</head>
<body>
<h2>西武線リアルタイム列車位置（種別色分け対応）</h2>
<div id="controls">
路線：<select id="lineSelect"></select>
</div>
<canvas id="diagram" width="1400" height="500"></canvas>
<pre id="log"></pre>


<!-- 同じフォルダに routes.js を置いてください -->
<script src="routes.js"></script>
<script>
// ====== 簡易ログ ======
function log(msg){
const el = document.getElementById('log');
const time = new Date().toLocaleTimeString();
el.textContent += `[${time}] ${msg}\n`;
}


if (typeof routes === 'undefined') {
log('エラー: routes.js が読み込めていません。index.html と同じフォルダに routes.js を置いてください。');
}


// ====== 種別色マップ ======
const TRAIN_TYPE_COLORS = {
"特急": "#e6002d",
"急行": "#ff6600",
"快速急行": "#c00000",
"快速": "#0099e6",
"準急": "#009933",
"通勤急行": "#cc3300",
"通勤準急": "#33aa66",
"S-TRAIN": "#0066cc",
"各駅停車": "#555555",
"普通": "#555555"
};


const canvas = document.getElementById("diagram");
const ctx = canvas.getContext("2d");


function adjustCanvasSize(stList) {
if (!stList || !stList.length) return;
const maxX = Math.max(...stList.map(s => s.x));
canvas.width = Math.max(800, maxX + 100);
}


function drawLine(stList) {
if (!stList || !stList.length) return;
ctx.clearRect(0,0,canvas.width,canvas.height);
ctx.strokeStyle = "#000";
ctx.lineWidth = 4;
ctx.beginPath();
ctx.moveTo(stList[0].x, stList[0].y);
for (let i=1; i<stList.length; i++) ctx.lineTo(stList[i].x, stList[i].y);
ctx.stroke();


ctx.fillStyle = "#000";
ctx.font = "14px sans-serif";
for (let s of stList) {
ctx.beginPath();
ctx.arc(s.x, s.y, 10, 0, Math.PI*2);
ctx.fill();
ctx.fillText(s.name, s.x - 20, s.y + 25);
}
}


function drawTrain(x, y, label, typeName) {
const color = TRAIN_TYPE_COLORS[typeName] || "#000";
ctx.fillStyle = color;
ctx.beginPath();
ctx.arc(x, y - 25, 12, 0, Math.PI*2);
ctx.fill();